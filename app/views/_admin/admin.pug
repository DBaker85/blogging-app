extends ../_base/layout.pug
block append styles
  link(rel="stylesheet", href="../css/admin.css")
block content
  .admin.wrapper.skin-red(ng-controller="adminController as vm")
    header.main-header
      a.logo
        span.logo-mini
          | Blog
        span.logo-lg
          | Admin section
      nav.navbar.navbar-static-top
        .navbar-custom-menu
          ul.nav.navbar-nav
            li.dropdown.user.user-menu(ng-class="{open:vm.menuOpen}")
              a(ng-click="vm.menuOpen = !vm.menuOpen")
                span user
              ul.dropdown-menu
                li.user-header
                  img.img-circle(src="images/icons/user.svg" alt="user")
                  p
                    | User
                    span
                      | date?

                li.user-footer
                  a.btn.btn-default.btn-flat
                    | Sign out
    aside.main-sidebar
      section.main-sidebar
        ul.sidebar-menu
          li.header
            | Stuff
          li
            a(href="#" ng-click="vm.activeView = 'posts'")
              span
                | Posts
          li
            a(href="#" ng-click="vm.activeView = 'categories'")
              span
                | Categories
          li
            a(href="#" ng-click="vm.activeView = 'statistics'")
              span
                | Statistics
    .content-wrapper(ng-if="vm.activeView == 'posts'" ng-cloak)
      section.content-header
        | Edit posts
      section.content
        .row
          .col-md-8
            .box.box-primary
              .box-header.with-border
                h3 Create new post
              .box-body
                form(no-validate ng-submit="vm.createPost()")
                    +input({
                        classes:'input',
                        name:'title',
                        text: 'Post title',
                        error: 'Field is alphanumerical with spaces and basic punctuation only',
                        attributes:{
                            'maxlength':'60',
                            'minlength':'4',
                            'required':'required',
                            'ng-pattern':'/^[0-9A-Za-z\d\ \?\!\.\,]+$/',
                            'ng-model':'vm.createPost.title'
                        }
                    })
                    +input({
                        type: 'textarea',
                        name: 'body',
                        text: 'Post body',
                        attributes:{
                            'required':'required',
                            'ng-model':'vm.createPost.body'
                        }
                    })
                    select(name="category" ng-model="vm.createPost.category")
                      optgroup(label="{{category.category}}" ng-repeat="category in vm.categories")
                        option(value="{{subcategory.subcategory}}" ng-repeat="subcategory in category.subcategories")
                          | {{subcategory.subcategory}}
                    div(dropzone)
                      | add angular dropzone here
                    +button({
                        type:'submit',
                        text:'submit'
                    })

            .box.box-primary
              .box-header.with-border
                h3 Post preview
              .box-body(ng-init="vm.expandedPreview = false")
                .pull-right
                  button.btn-link(ng-click="vm.expandedPreview = !vm.expandedPreview")
                    span(ng-show="vm.expandedPreview")
                      | /\ Compact preview
                    span(ng-show="!vm.expandedPreview")
                      | \/ Full preview
                .post__content
                  article
                    .post__title
                      h2 {{vm.createPost.title}}
                    div(ng-cloak ng-if="vm.createPost.body.length > 1" ng-bind-html="vm.createPost.body | limitHtml: vm.expandedPreview")

          .col-md-4
            .box.box-primary
              .box-header.with-border
                h3 Articles
              .box-body
                ul.products-list.product-list-in-box
                  li.item(ng-repeat="post in vm.postList")
                    .row
                      .col-sm-10
                        .product-img
                          img(src="images/icons/file.svg" alt="Article Image")
                        .product-info
                          .product-title
                            | {{post.title}}

                          .product-description
                            .small
                              | Posted on {{post.date | date: 'EEE dd/MM/yy hh:mma'}}
                            .small(ng-if="post.editdate")
                              | Edited on {{post.editdate | date: 'EEE dd/MM/yy hh:mma'}}
                            small.label.label-primary
                              |  {{post.category}}
                      .col-sm-2
                        +button({
                          type:'icon',
                          icon: 'trash',
                          classes:'small',
                          attributes:{
                            'ng-click':'vm.deletePostConfirm(post)'
                          }
                        })
                        +button({
                          type:'icon',
                          icon: 'pencil',
                          classes:'small',
                          attributes:{
                            'ng-click':'vm.editPost(post)'
                          }
                      })

    .content-wrapper(ng-if="vm.activeView == 'categories'" ng-cloak)
      section.content-header
        | Edit categories
      section.content
        .row
          .col-md-8
            .box
              .box-header
                | Add tags
              .box-body
                h3 Create categories
                form.js-add-tags(method="put" action="/categories" data-parsley-validate)
                    +input({
                        text:'category',
                        name:'category',
                        classes:'js-category-input',
                        attributes: {
                            'required':'required',
                            'data-parsley-type':'alphanum'
                        }
                    })
                    +button({
                            type: 'primary',
                            icon: 'plus',
                            text: 'Add a subcategory',
                            classes:'js-add-subcategory small',
                            attributes :{
                                'data-tooltip':'Add a subcategory'
                            }
                    })
                    .js-subcategory-holders
                        .edit-tag__subcategory-holder
                            .edit-tag__subcategory--input
                                +input({
                                    text: 'subcategory',
                                    name:'subcategory',
                                    classes: 'js-subcategories',
                                    attributes: {
                                        'required':'required',
                                        'data-parsley-type':'alphanum'
                                    }
                                })



                    +button({
                        type:'submit',
                        text:'Create category'
                    })
            .box
              .box-header
                | edit tags
              .box-body
                .edit-tag__subcategory-holder
                  .edit-tag__subcategory--input
                    +input({
                        text: 'subcategory',
                        name:'subcategory',
                        classes: 'js-subcategories',
                        attributes: {
                            'required':'required',
                            'data-parsley-type':'alphanum'
                        }
                    })
          .col-md-4
            .box.no-padding
              .box-header
                .box-title
                  | Available tags
                .box-body
                  table.table.table-striped(ng-repeat="category in vm.categories")
                    tbody
                      tr
                        th.bg-primary.text-center.text-capitalize.disabled(colspan="3")
                          strong {{category.category}}
                    tbody
                      tr(ng-repeat="subcategory in category.subcategories")
                        td
                          | {{subcategory.subcategory}}
                        td.text-right
                          span.label.label-success(ng-if="subcategory.active")
                            | In use
                        td.text-right
                          +button({
                              type: 'icon',
                              icon: 'trash',
                              classes: 'small',
                              attributes: {

                              }
                          })

    .content-wrapper(ng-if="vm.activeView == 'statistics'" ng-cloak)
      section.content-header
        | Visitor stats
      section.content
        .row
          .col-md-8
            .box.box-success.no-padding
              .box-header
                .box-title
                  | Visitors
                .box-tools.pull-right(ng-if="!vm.visitorChart.loaded")
                  i.glyphicon.glyphicon-refresh.spin
              .box-body.no-padding
                div(google-chart chart="vm.visitorChart" agc-on-ready="vm.visitorChart.loaded = true")
          .col-md-4
            .box.box-warning.no-padding
              .box-header
                .box-title
                  | Platform
              .box-body
                div(google-chart chart="vm.platformChart" agc-on-ready="vm.platformChart.loaded = true")
            .box.box-warning.no-padding
              .box-header
                .box-title
                  | Device
              .box-body
                div(google-chart chart="vm.deviceChart" agc-on-ready="vm.platformChart.loaded = true")
      section.content-header
        | Browser Stats
      section.content
        .row
          .col-md-4
            .box.box-success.no-padding
              .box-header
                .box-title
                  | Chrome
              .box-body
                div(google-chart chart="vm.chromeChart" agc-on-ready="vm.osChart.loaded = true")
          .col-md-4
            .box.box-warning.no-padding
              .box-header
                .box-title
                  | Firefox
              .box-body
                div(google-chart chart="vm.firefoxChart" agc-on-ready="vm.osChart.loaded = true")
          .col-md-4
            .box.box-danger.no-padding
              .box-header
                .box-title
                  | Opera
              .box-body
                div(google-chart chart="vm.operaChart" agc-on-ready="vm.osChart.loaded = true")
        .row
          .col-md-4
            .box.no-padding
              .box-header
                .box-title
                  | Internet explorer
              .box-body
                div(google-chart chart="vm.IEChart" agc-on-ready="vm.osChart.loaded = true")
          .col-md-4
            .box.no-padding
              .box-header
                .box-title
                  | Safari
              .box-body
                div(google-chart chart="vm.safariChart" agc-on-ready="vm.osChart.loaded = true")
          .col-md-4
            .box.box-warning.no-padding
              .box-header
                .box-title
                  | OS
              .box-body
                div(google-chart chart="vm.osChart" agc-on-ready="vm.osChart.loaded = true")
